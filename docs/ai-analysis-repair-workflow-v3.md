# ScriptAI 完整工作流程文档 - V1 API架构（生产版本）

## 文档说明 📋

**本文档描述的是当前生产环境使用的V1 API架构**，包括完整的五幕剧工作流程和数据库持久化系统。

**架构版本**: V1 API (Database-backed, Epic 004-007)
**更新日期**: 2025-10-02
**文档版本**: 3.0.0

## 目录
- [系统概述](#系统概述)
- [完整工作流程图](#一完整工作流程图)
- [手动使用指南](#二手动使用指南step-by-step)
- [核心技术实现](#三核心技术实现细节)
- [API端点列表](#四api端点完整列表)
- [环境配置](#五环境变量配置)
- [文件位置速查](#六关键文件位置速查)
- [常见问题FAQ](#七常见问题faq)
- [测试验证清单](#八测试验证清单)

---

## 系统概述

ScriptAI 是一个基于AI的剧本分析与协作修改系统，采用"五幕剧"工作流程：

1. **Act 1 - 基础诊断** (ConsistencyGuardian): 检测5类剧本错误
2. **Act 2 - 角色弧光** (CharacterArchitect): 迭代修复角色矛盾
3. **Act 3 - 世界观审查** (RulesAuditor): 审查设定一致性与主题对齐
4. **Act 4 - 节奏优化** (PacingStrategist): 优化情节节奏和冲突分布
5. **Act 5 - 主题润色** (ThematicPolisher): 强化角色深度和共情力
6. **Synthesis - 综合整合** (SynthesisEngine): 智能合并所有修改为最终剧本(V2)

### 核心架构特点

- ✅ **数据库持久化**: PostgreSQL + Prisma ORM，所有数据服务器端存储
- ✅ **异步任务队列**: WorkflowQueue处理长时间AI分析，状态轮询机制
- ✅ **五幕工作流状态机**: WorkflowStatus枚举追踪进度
- ✅ **AI Agent系统**: 5个专业Agent处理不同幕的分析和生成任务
- ✅ **智能冲突检测**: 自动识别并解决6类决策冲突
- ✅ **风格保持系统**: 6维度风格分析，确保生成剧本与原文一致

---

[继续阅读完整文档...请查看ai-analysis-repair-workflow.md文件]
