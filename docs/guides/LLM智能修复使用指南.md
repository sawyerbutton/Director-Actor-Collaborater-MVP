# LLM智能修复功能使用指南

## 功能改进说明

### 之前的问题
- ❌ **硬文本替换**：直接替换文本，破坏剧本连贯性
- ❌ **无上下文理解**：修改后的内容与前后文不协调
- ❌ **风格不一致**：修复后失去原有的语言风格

### 现在的方案
- ✅ **AI智能重写**：LLM理解全文后智能修复
- ✅ **保持连贯性**：修改自然融入上下文
- ✅ **风格一致**：保留原剧本的语言特色

## 测试步骤

### 1. 选择要修复的错误
在分析结果页面：
- 点击 **"接受修改"** - 选择需要修复的错误
- 点击 **"拒绝修改"** - 标记不需要修复的内容
- 可以随时 **"撤销决定"** 重新选择

### 2. 使用AI智能修复
页面底部新增了 **"AI智能修复"** 区域：

```
🤖 AI智能修复
使用AI根据您接受的修改建议，智能重写剧本，保持内容连贯性和风格一致性

[开始AI智能修复 (3项修改)]  <- 点击此按钮
```

### 3. 预览修复结果
- AI修复完成后会弹出预览窗口
- 可以查看完整的修复后剧本
- 确认满意后点击"导出修复后的剧本"

## 技术实现原理

### API调用流程
```
用户选择修改项 → 调用/api/script-repair → DeepSeek AI处理 → 返回智能修复结果
```

### AI提示词策略
AI会收到：
1. 完整的原始剧本
2. 用户接受的修改建议（详细信息）
3. 用户拒绝的修改（作为参考，不修改）

AI被要求：
- 保持剧本的整体风格和语言特色
- 确保修改与上下文自然衔接
- 不生硬替换，而是重新组织语言
- 保留原剧本的情感基调和人物性格
- 考虑多个修改之间的关联性

## 测试示例

### 输入
原文：`李华：还记得我吗？我们昨天才第一次见面。`
问题：时间线不一致
建议：`李华：还记得我吗？我们上次见面已经很久了。`

### 传统替换结果
直接替换为建议文本（生硬）

### AI智能修复结果
`李华：（微笑着）还记得我吗？虽然我们上次见面已经有些日子了，但我一直记得那次的谈话。`

AI会：
- 添加合适的情感描写
- 自然地过渡到下文
- 保持角色的性格特征

## 优势对比

| 特性 | 硬文本替换 | AI智能修复 |
|-----|----------|-----------|
| 连贯性 | ❌ 可能断裂 | ✅ 自然流畅 |
| 风格保持 | ❌ 风格突变 | ✅ 风格一致 |
| 上下文理解 | ❌ 无 | ✅ 完整理解 |
| 修改质量 | ⭐⭐ | ⭐⭐⭐⭐⭐ |
| API成本 | 💰 免费 | 💰💰 需要调用 |

## 注意事项

1. **选择修改项**：请仔细选择要接受的修改，AI会根据您的选择进行修复
2. **预览确认**：修复后请仔细预览，确认符合预期再导出
3. **API限制**：频繁调用可能受到限流，建议一次性选择所有修改项
4. **修复时间**：根据剧本长度，修复可能需要5-15秒

## 后续优化计划

- [ ] 支持分段修复（长剧本）
- [ ] 添加修复历史记录
- [ ] 支持多种修复风格选择
- [ ] 实现修复对比视图
- [ ] 添加修复评分功能