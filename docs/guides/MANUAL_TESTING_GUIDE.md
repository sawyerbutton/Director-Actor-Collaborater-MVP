# ScriptAI MVP - 手动测试指南

## 服务器信息

**开发服务器地址**: http://localhost:3000
**启动状态**: ✅ 运行中
**数据库**: PostgreSQL (localhost:5432)
**限流**: 已禁用（开发模式）

---

## 📋 快速健康检查清单

### 1. 系统健康检查 (2分钟)

#### ✅ API健康端点
```bash
curl http://localhost:3000/api/health
```
**期望结果**: 返回JSON，包含 `{"success": true, "data": {...}}`

#### ✅ 数据库连接
```bash
docker ps | grep director-postgres
```
**期望结果**: 看到PostgreSQL容器运行状态 "Up X hours/days"

#### ✅ 主页访问
浏览器打开: http://localhost:3000
**期望结果**: 看到导航栏，页面正常加载，无控制台错误

---

## 🎯 完整五幕工作流测试 (15-20分钟)

### 第一步：Dashboard - 上传剧本 (2分钟)

**URL**: http://localhost:3000/dashboard

**操作步骤**:
1. ✅ 页面加载正常，看到"AI剧本分析系统"标题
2. ✅ 看到上传区域："拖拽文件到此处或点击选择"
3. ✅ 准备测试文件：
   - 格式：`.txt` 或 `.md`
   - 大小：500-10000行
   - 内容：中文剧本（场景、角色、对话）

**上传测试**:
- 点击上传区域，选择文件
- 或者拖拽文件到上传区域

**检查点**:
- ✅ 文件名显示正确
- ✅ 文件大小显示
- ✅ "开始AI分析"按钮可点击（蓝色）
- ❌ 如果上传`.fdx`或`.docx`，应该显示错误提示

**启动分析**:
- 点击"开始AI分析"按钮
- **期望**: 自动跳转到 `/analysis/[projectId]`

---

### 第二步：Act 1 分析页面 (3-5分钟)

**URL**: http://localhost:3000/analysis/[projectId]

**自动行为**:
1. ✅ 页面显示进度条
2. ✅ 状态显示"QUEUED" → "PROCESSING" → "COMPLETED"
3. ✅ 每2秒自动刷新状态（检查Network标签）

**等待时间**: 30秒 - 2分钟（取决于剧本长度）

**分析完成后检查**:
- ✅ 显示5类错误统计卡片：
  1. 时间线一致性 (Timeline)
  2. 角色一致性 (Character)
  3. 剧情一致性 (Plot)
  4. 对话一致性 (Dialogue)
  5. 场景一致性 (Scene)

- ✅ 每个错误类型显示：
  - 错误名称（中文）
  - 严重程度标签（高/中/低）
  - 问题描述
  - 涉及场景/角色

- ✅ "进入迭代工作区"按钮可见

**问题检查**:
- ❌ 如果超过5分钟仍是"PROCESSING"：检查DeepSeek API密钥
- ❌ 如果显示"FAILED"：查看浏览器控制台错误

**进入下一步**:
- 点击"进入迭代工作区"按钮
- **期望**: 跳转到 `/iteration/[projectId]`

---

### 第三步：Iteration 页面 - Acts 2-5 (5-10分钟)

**URL**: http://localhost:3000/iteration/[projectId]

#### 界面组件检查

**✅ 顶部Act进度条**:
- 5个圆形图标：Act 1-5
- Act 1 应该显示为完成（绿色勾选）
- Acts 2-5 显示待处理（灰色）

**✅ 左侧面板 - Act选择器**:
- 4个Act选项卡：
  - Act 2: 角色弧光 (Character Arc)
  - Act 3: 世界观构建 (Worldbuilding)
  - Act 4: 节奏优化 (Pacing)
  - Act 5: 主题打磨 (Theme)

**✅ 中间面板 - 问题选择器**:
- 显示Act 1发现的问题列表
- 每个问题显示：名称、类型标签、严重程度

**✅ 右侧面板 - 提案对比区域**:
- 初始状态显示"选择一个问题以获取AI解决方案"

---

#### Act 2 测试：角色弧光（推荐先测试）

**步骤**:
1. 点击"Act 2: 角色弧光"选项卡
2. 在问题列表中选择一个**角色一致性**错误（character类型）
3. 点击"获取AI解决方案提案"按钮

**等待时间**: 10-30秒

**检查提案显示**:
- ✅ 显示2个提案卡片（并排）
- ✅ 每个提案包含：
  - 标题（方案1/方案2）
  - 描述
  - "优点"列表（✓ 图标）
  - "缺点"列表（✗ 图标）
  - 推荐标签（通常在方案1上）
  - "选择此方案"按钮

**选择并执行**:
4. 点击任一提案的"选择此方案"按钮
5. **等待**: 15-45秒（执行P6提示词 - "Show Don't Tell"转换）

**检查执行结果**:
- ✅ 显示"生成的修改内容"标题
- ✅ 显示具体的戏剧化动作建议（中文）
- ✅ 包含整体角色弧光总结
- ✅ 包含集成建议

**验证数据保存**:
- 刷新页面
- ✅ 决策应该保留
- ✅ Act进度条中Act 2应显示完成状态

---

#### Act 3 测试：世界观构建

**步骤**:
1. 切换到"Act 3: 世界观构建"
2. 选择一个**场景一致性**或**剧情一致性**错误
3. 获取提案 → 选择 → 执行

**检查点**:
- ✅ 提案数量：可能2个或更多
- ✅ 包含"涉及效应"分析（ripple effects）
- ✅ 执行后显示"设定-主题对齐"策略（P9）

---

#### Act 4 测试：节奏优化

**步骤**:
1. 切换到"Act 4: 节奏优化"
2. 选择任一问题（时间线/剧情类型）
3. 获取提案 → 选择 → 执行

**检查点**:
- ✅ 提案包含节奏分析（P10）
- ✅ 提案包含冲突重分配策略（P11）
- ✅ 执行后直接应用策略（无额外AI调用）

---

#### Act 5 测试：主题打磨

**步骤**:
1. 切换到"Act 5: 主题打磨"
2. 选择**角色一致性**错误
3. 获取提案 → 选择 → 执行

**检查点**:
- ✅ 提案包含角色去标签化分析（P12）
- ✅ 执行后显示核心恐惧与信念（P13）
- ✅ 显示共情钩子（empathy hooks）

---

#### 决策历史检查

**步骤**:
1. 在顶部切换到"决策历史"标签页
2. 查看所有已做的决策

**检查点**:
- ✅ 显示决策总数
- ✅ 每个决策显示：
  - Act类型
  - 问题名称
  - 选择的提案索引
  - 时间戳
- ✅ 可以按Act类型筛选

---

#### 进入合成阶段

**条件**: 至少完成1个决策（推荐每个Act至少1个）

**操作**:
- 点击页面右上角"生成最终剧本 (N)"按钮（N=决策数量）
- **期望**: 跳转到 `/synthesis/[projectId]`

---

### 第四步：Synthesis 页面 - V2生成 (5-8分钟)

**URL**: http://localhost:3000/synthesis/[projectId]

#### 配置合成选项

**✅ 弹出对话框包含**:
1. "保留原始风格"开关（推荐开启）
2. 冲突解决策略选择：
   - 自动协调（推荐）
   - 最新优先
   - 合并兼容
   - 按严重程度优先
3. "包含修改日志"开关
4. "验证一致性"开关

**推荐配置**:
- ✅ 保留原始风格：开启
- ✅ 冲突解决：自动协调
- ✅ 包含修改日志：开启
- ✅ 验证一致性：开启

**启动合成**:
- 点击"开始合成"按钮

---

#### 监控合成进度（实时更新）

**10步进度**:
1. ✅ 分组决策 (Grouping Decisions)
2. ✅ 冲突检测 (Conflict Detection)
3. ✅ 冲突解决 (Conflict Resolution)
4. ✅ 风格分析 (Style Analysis)
5. ✅ 提示词构建 (Prompt Building)
6. ✅ 分块处理 (Chunking) - 仅长剧本
7. ✅ AI生成 (AI Generation)
8. ✅ 合并分块 (Merging Chunks)
9. ✅ 验证 (Validation)
10. ✅ 版本创建 (Version Creation)

**等待时间**:
- 小剧本（<1000行）：2-5分钟
- 中等剧本（1000-3000行）：5-10分钟
- 大剧本（3000-10000行）：10-30分钟

**检查进度条**:
- ✅ 每步显示进度百分比
- ✅ 当前步骤高亮
- ✅ 完成步骤显示绿色勾选
- ✅ 每2秒自动更新

---

#### 查看合成结果

**完成后3个标签页**:

**1. 最终剧本 (V2)**:
- ✅ 显示完整的V2剧本
- ✅ 顶部显示元数据：
  - 版本号：V2
  - 应用的决策数量
  - 置信度分数（0-1）
  - 生成时间
- ✅ 剧本内容保持中文
- ✅ 风格与原剧本一致

**2. 修改日志**:
- ✅ 显示所有修改的详细列表
- ✅ 每个修改包含：
  - 修改类型（角色/场景/对话等）
  - 决策ID引用
  - 修改前内容
  - 修改后内容
  - 修改原因

**3. 版本对比**:
- ✅ 左侧：V1（原始剧本）
- ✅ 右侧：V2（合成剧本）
- ✅ 并排显示
- ✅ 可以滚动查看全部内容
- ✅ 修改部分高亮显示（如果实现）

---

#### 导出功能测试

**步骤**:
1. 在任一标签页，点击"导出"按钮
2. 选择格式：TXT 或 MD
3. 点击"确认导出"

**检查点**:
- ✅ 文件下载开始
- ✅ 文件名格式：`[项目名]-V2-[时间戳].txt`
- ✅ 文件包含完整剧本内容
- ✅ 如果选择"包含元数据"，应包含版本信息

---

## 🚨 常见问题排查

### 问题1: 上传文件后无反应

**检查**:
- ✅ 浏览器控制台（F12）是否有错误
- ✅ 文件格式是否正确（`.txt`/`.md`）
- ✅ 文件大小是否在500-10000行之间
- ✅ Network标签：是否有`POST /api/v1/projects`请求

**解决方案**:
```bash
# 检查数据库连接
docker ps | grep director-postgres

# 查看服务器日志
# （检查后台Bash输出）
```

---

### 问题2: Act 1 分析卡在"PROCESSING"

**检查**:
- ✅ 是否超过5分钟
- ✅ DeepSeek API密钥是否正确配置

**查看日志**:
```bash
# 检查.env.local文件
cat .env.local | grep DEEPSEEK_API_KEY

# 测试API连接
curl -H "Authorization: Bearer YOUR_API_KEY" \
  https://api.deepseek.com/v1/models
```

**解决方案**:
- 确认API密钥有效
- 检查API配额是否用尽
- 查看服务器错误日志

---

### 问题3: Iteration页面提案请求失败

**检查**:
- ✅ Network标签：`POST /api/v1/iteration/propose`是否返回错误
- ✅ 响应状态码：应该是202
- ✅ 错误消息内容

**常见原因**:
- DeepSeek API限流（等待1分钟后重试）
- JSON格式错误（检查控制台）
- 网络超时（增加timeout设置）

---

### 问题4: Synthesis卡住不动

**检查**:
- ✅ 是否有大量决策（>20个）
- ✅ 剧本是否过长（>5000行）
- ✅ Network标签：是否持续轮询状态

**正常行为**:
- 每2秒一次`GET /api/v1/synthesize/[jobId]/status`
- 长剧本可能需要10-30分钟

**异常行为**:
- 状态一直不变化（超过5分钟）
- 返回错误状态码

---

## 📊 性能基准

### 预期响应时间

| 操作 | 小剧本 | 中等剧本 | 大剧本 |
|------|--------|----------|--------|
| **上传** | <1秒 | <2秒 | <5秒 |
| **Act 1分析** | 30-60秒 | 1-3分钟 | 3-8分钟 |
| **获取提案** | 10-20秒 | 20-40秒 | 40-90秒 |
| **执行提案** | 15-30秒 | 30-60秒 | 60-120秒 |
| **合成V2** | 2-5分钟 | 5-15分钟 | 10-30分钟 |

### 资源使用

**数据库查询**:
- ✅ 每个请求：2-5个查询
- ✅ 分析期间：每3秒轮询
- ✅ 合成期间：每2秒轮询

**API调用**:
- ✅ Act 1：1-3次DeepSeek调用
- ✅ Act 2-5提案：1次调用
- ✅ Act 2-5执行：1次调用
- ✅ Synthesis：1-5次调用（取决于分块）

---

## ✅ 完整测试检查表

打印此清单，逐项勾选：

### 基础功能
- [ ] 服务器启动成功（localhost:3000）
- [ ] 健康端点返回正常
- [ ] 数据库容器运行
- [ ] 主页加载无错误

### Dashboard
- [ ] 上传区域显示正常
- [ ] 文件拖拽上传有效
- [ ] 文件点击上传有效
- [ ] 错误文件格式被拒绝
- [ ] "开始分析"按钮可点击
- [ ] 分析启动后跳转成功

### Analysis (Act 1)
- [ ] 进度条显示正常
- [ ] 状态自动更新
- [ ] 5类错误统计显示
- [ ] 错误详情可查看
- [ ] "进入迭代"按钮可点击

### Iteration (Acts 2-5)
- [ ] Act进度条显示
- [ ] 问题列表加载
- [ ] Act 2提案生成成功
- [ ] Act 2执行成功
- [ ] Act 3提案生成成功
- [ ] Act 3执行成功
- [ ] Act 4提案生成成功
- [ ] Act 4执行成功
- [ ] Act 5提案生成成功
- [ ] Act 5执行成功
- [ ] 决策历史显示正确
- [ ] "生成最终剧本"按钮显示决策数

### Synthesis
- [ ] 配置对话框显示
- [ ] 合成进度实时更新
- [ ] 10步进度全部完成
- [ ] V2剧本显示正确
- [ ] 修改日志显示
- [ ] 版本对比功能正常
- [ ] 导出TXT成功
- [ ] 导出MD成功

### 错误处理
- [ ] 无效文件格式显示错误
- [ ] API失败显示友好提示
- [ ] 网络错误可重试
- [ ] 超时显示警告

---

## 🎯 推荐测试顺序

1. **快速烟雾测试**（5分钟）
   - 健康检查 → Dashboard → 上传小文件 → Act 1分析

2. **核心流程测试**（15分钟）
   - 完整五幕流程（每个Act选1个决策）

3. **完整功能测试**（30分钟）
   - 每个Act多个决策
   - 测试所有错误类型
   - 测试导出功能

4. **压力测试**（可选，60分钟）
   - 大剧本（>5000行）
   - 大量决策（>20个）
   - 并发请求

---

## 📞 获取帮助

**查看实时日志**:
```bash
# 在Claude Code中查看后台进程输出
# 使用BashOutput工具查看进程03a554
```

**数据库状态**:
```bash
docker logs director-postgres --tail 50
```

**检查Prisma连接**:
```bash
npx prisma studio
# 打开 http://localhost:5555 查看数据库
```

---

**祝测试顺利！** 🚀

如有任何问题，请查看控制台错误信息或服务器日志。
